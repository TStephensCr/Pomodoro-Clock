<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pomodoro Study Timer</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
  }

  body {
    font-family: Arial, sans-serif;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    height: 100%;
    width: 100%;
    background-image: url("waterfall.gif");
    background-size:cover;
    background-repeat: no-repeat;
    background-attachment: fixed;
  }

  #main-content{
    top: 0;
    text-align: center;
    position: relative;
    z-index: 10;
  }

  #safeTimerDisplay{
    top:0%;
    font-size: 7em;
    margin: 0;
    text-align: center;
    color: #1f235d;
  }

  /* Chrome, Safari, Edge, Opera */
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* Firefox */
  input[type=number] {
    -moz-appearance: textfield;
  }

  input[type=number] {
    color: #1f235d;
    width: 10%;
    outline: none;
    background-color: transparent;
		border: none;
    border-bottom: 2px solid #000;
    text-align: center;
    font-size: 2em;
    margin-top:10%;
    margin-bottom: 3%;
  }

  input::placeholder{
    color: #1f235d;
  }

  #buttonsDiv{
    display:flex;
    flex-direction:row;
    justify-content: center;
  }
  
  button{
    cursor:pointer;
    margin: 0.5%;
    padding: 1%;
    background-color: #2b65a1;
    box-shadow: 0 6px 6px rgba(0, 0, 0, 0.6);
  }

  #wave-container{
    position:fixed;
    top:0;
    left:0;
    height:100%;
    width:100%;
    z-index: -1;
  }

  #whiteBox{
    position:absolute;
    top:100%;
    left:0;
    height:100%;
    width:100%;
    background-color:rgba(35,181,211,0.9);
  }

  .waves {
  position:relative;
  top:90%;
  width: 100%;
  height:100%;
  margin-bottom:-7px; /*Fix for safari gap*/
  min-height:0%;
  max-height:10%;
}

.parallax > use {
  animation: move-forever 25s cubic-bezier(.55,.5,.45,.5)     infinite;
}
.parallax > use:nth-child(1) {
  animation-delay: -2s;
  animation-duration: 7s;
}
.parallax > use:nth-child(2) {
  animation-delay: -3s;
  animation-duration: 10s;
}
.parallax > use:nth-child(3) {
  animation-delay: -4s;
  animation-duration: 13s;
}
.parallax > use:nth-child(4) {
  animation-delay: -5s;
  animation-duration: 20s;
}
@keyframes move-forever {
  0% {
   transform: translate3d(-90px,0,0);
  }
  100% { 
    transform: translate3d(85px,0,0);
  }
}

</style>
</head>
<body>

  <div id="wave-container">
    <svg id="wavesID" class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
    <defs>
    <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
    </defs>
    <g class="parallax">
    <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(35,181,211,0.5)" />
    <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(35,181,211,0.3)" />
    <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(35,181,211,0.1)" />
    <use xlink:href="#gentle-wave" x="48" y="7" fill="rgba(35,181,211,0.7)" />
    </g>
    </svg>
    <div id="whiteBox"></div>
  </div>

  <div id="main-content">
    <p id="safeTimerDisplay">00:00</p>
    <div id="safeTimer">
      <input type="number" id="safeTimerInputStudy" placeholder="work"></input>
      <input type="number" id="safeTimerInputBreak" placeholder="break"></input>
      <div id="buttonsDiv">
        <button id="TimerButton" onClick="startOrStop()">Start Timer</button>
        <button id="ResetButton" onClick="resetTimer()">Reset Timer</button>
      </div>
    </div>
  </div>

  
  <script>
      let timer;
      let timeLeft;
      let isRunning = false;
      let initialTime; // Added to store initial time
      let safeTimer = document.getElementById("safeTimer");
      let safeTimerDisplay = document.getElementById("safeTimerDisplay");
      let safeTimerInputStudy = document.getElementById("safeTimerInputStudy");
      let TimerButton = document.getElementById("TimerButton");
      let ResetButton = document.getElementById("ResetButton"); 
      let wavesStart;
      let stopAnimation = false;

      function startOrStop() {
        if (isRunning) {
          clearInterval(timer);
          isRunning = false;
          stopAnimation = true;
          TimerButton.innerHTML = "Resume Timer";
          wavesStart = parseFloat(document.getElementById("wavesID").style.top);
        } else {
          let time = safeTimerInputStudy.value.trim();
          if(time == ''){
            alert("Please enter a valid amount of time");
            return;
          }
          if (!initialTime) {
            initialTime = time * 60;
            timeLeft = initialTime; // Initialize timeLeft if it hasn't been set
            wavesStart = 90;
            wavesEnd = 0;
          }
          smoothChange("wavesID", wavesStart, 0, timeLeft * 1000); // Start animation
          smoothChange("whiteBox", (wavesStart+10), 10, timeLeft * 1000); // Start animation
          timer = setInterval(() => {
            timeLeft--; // Decrement timeLeft on each interval
            if (timeLeft <= 0) {
              clearInterval(timer);
              isRunning = false;
              TimerButton.innerHTML = "Start Timer";
            }
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            safeTimerDisplay.innerHTML = `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
          }, 1000);
          isRunning = true;
          TimerButton.innerHTML = "Pause Timer";
        }
      }

      function resetTimer() {
        clearInterval(timer); // Stop the timer
        timeLeft = initialTime; // Reset timeLeft to initialTime
        isRunning = false;
        stopAnimation = true;
        TimerButton.innerHTML = "Start Timer"; // Reset button text
        safeTimerDisplay.innerHTML = "00:00"; // Reset display
        document.getElementById("wavesID").style.setProperty("top", `90%`);
        document.getElementById("whiteBox").style.setProperty("top", `100%`);
        initialTime = null; // Reset initialTime
      }

      function smoothChange(element, startValue, endValue, duration) {
        let startTime = null;
        stopAnimation = false;
        function updateValue(timestamp) {
          if (!startTime) startTime = timestamp;
          let elapsedTime = timestamp - startTime;
          let progress = Math.min(elapsedTime / duration, 1); // Ensure progress does not exceed 1
          let interpolatedValue = startValue + (endValue - startValue) * progress;
          console.log("Start Value: ", startValue);
          console.log("End Value: ", endValue);
          console.log("Progress: ", progress);
          console.log("Interpolated Value: ", interpolatedValue);
          document.getElementById(element).style.setProperty("top", `${interpolatedValue}%`);
          if (elapsedTime < duration && !stopAnimation) {
            // Continue updating until duration is reached
            console.log("Updating");
            requestAnimationFrame(updateValue);
          }
        }

        requestAnimationFrame(updateValue);
        stopAnimation = false;
      }

  </script>
  
  </body>
  </html>